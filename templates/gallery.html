{% extends 'base.html' %}
{% load static %}

{% block title %}Gallery | Better Homes Initiative{% endblock %}

{% block content %}
<header class="py-5 bg-white text-center">
    <div class="container">
        <h1 class="fw-bold text-bhi-green">Our Gallery</h1>
        <p class="text-muted">Moments captured from the field.</p>
    </div>
</header>

<section class="py-4 bg-light">
    <div class="container">
        <div class="row g-3" data-masonry='{"percentPosition": true }'>
            {% for image in images %}
            <div class="col-md-4 col-sm-6">
                <div class="card border-0 shadow-sm hover-lift">
                    <img src="{{ image.url }}" 
                         class="card-img-top gallery-img cursor-pointer" 
                         alt="{{ image.caption }}" 
                         data-bs-toggle="modal" 
                         data-bs-target="#imageModal"
                         data-img-src="{{ image.url }}"
                         data-img-caption="{{ image.caption }}">
                    {% if image.caption %}
                    <div class="card-body p-2 text-center">
                        <small class="text-muted">{{ image.caption }}</small>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Lightbox Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-body p-0 position-relative text-center">
                <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3 z-3" data-bs-dismiss="modal" aria-label="Close"></button>
                <img src="" id="modalImage" class="img-fluid rounded shadow-lg" alt="Full view">
                <div class="bg-dark text-white p-2 mt-2 rounded d-none" id="modalCaption"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" async></script>
<script>
    // Simple script to pass image data to modal
    const imageModal = document.getElementById('imageModal');
    imageModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const imgSrc = button.getAttribute('data-img-src');
        const caption = button.getAttribute('data-img-caption');
        
        const modalImg = imageModal.querySelector('#modalImage');
        const modalCap = imageModal.querySelector('#modalCaption');
        
        modalImg.src = imgSrc;
        if(caption) {
            modalCap.textContent = caption;
            modalCap.classList.remove('d-none');
        } else {
            modalCap.classList.add('d-none');
        }
    });
</script>
{% endblock %}